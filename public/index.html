<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ColorMixr - RGB/HSV to CMYK/RYB Ratios</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%235D5DFF' d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-6h-2v6zm0-8h2V7h-2v2z'/%3E%3C/svg%3E" type="image/svg+xml">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="logo">ColorMixr <span class="logo-icon">&#x2728;</span></h1>
            <p class="subtitle">RGB/HSV to CMYK/RYB Ratios</p>
        </header>

        <main class="card">
            <div class="input-section">
                <input type="text" id="colorInput" placeholder="Enter color value (e.g., 5F2A1D, #5F2A1D, 95,42,29, 001 12 34, 0 0.7 0.37)" aria-label="Color Input">
                <button id="convertButton">Convert</button>
            </div>
            <p class="input-tip">
                <span class="icon">?</span> Input can be RGB or HSV. For integer RGB, use at least one 3-digit number (eg. 012).
            </p>
            <div id="errorMsg" style="color:#ff6b6b; display:none; margin-bottom:10px;"></div>
            <div id="resultsSection" class="results-section hidden">
                <h2>Results</h2>
                <div class="result-grid">
                    <div class="card result-card input-color-card">
                        <h3>Input Color</h3>
                        <div id="inputColorBlock" class="color-block"></div>
                        <p>RGB: <span id="outputHex"></span></p>
                        <p>RGB: <span id="outputRGB"></span></p>
                        <p>HSV: <span id="outputHSV"></span></p>
                    </div>
                    <div class="card result-card mixing-ratios-card">
                                                                        <h3 style="margin-bottom:0px; display:flex; align-items:center; justify-content:center; text-align:center;">
                                                                            <span style="display:inline-block;">Mixing Ratios</span>
                                                      <span class="tip-icon" tabindex="0" style="display:inline-block; margin-left:8px; cursor:pointer; position:relative;">
                                                        <svg width="18" height="18" viewBox="0 0 20 20" fill="none" style="vertical-align:middle;"><circle cx="10" cy="10" r="10" fill="#5d5dff"/><text x="10" y="15" text-anchor="middle" font-size="13" fill="#fff" font-family="Segoe UI,Arial,sans-serif">i</text></svg>
                                                        <span class="tip-tooltip" style="display:none; position:absolute; left:24px; top:0; z-index:10; background:#23263a; color:#fff; font-size:0.7em; font-family:Segoe UI,Arial,sans-serif; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.18); padding:14px 18px; max-width:800px; min-width:400px; line-height:1.5; text-align:left; font-weight: normal;">
                                                            <b>Why is white (W) included?</b><br>
                                                            W means white. When applying paint on paper, white is provided by the paper. If the paper is translucent or the paint is covering the entire surface with no transparency, white paint should be added to provide the white that is otherwise provided by the paper.<br><br>
                                                            <b>About the mixing:</b><br>
                                                            The mix is mathematical and represents 3/4/5 layers of paint of each color, each layer has their own percentage coverage, not a physical simulation of real-world pigment particle mixed together. The result should be understood as a guide for what to add on top of a neutral color to approximate the given tint.<br><br>
                                                            <b>About Ncol:</b><br>
                                                            NCol specifies colors using a color letter with a number to specify the distance (in percent) from the color. For example, R100 is pure red, R70 is a mix of 70% red and 30% of the next color on the color wheel (yellow), hence R70 is closer to yellow than to red. The color wheel order is Red-Yellow-Green-Cyan-Blue-Magenta-Red. The NCol system also includes white and black components to adjust whiteness (whiter means less satrate) and darkness (black pigments than absorb all color/light). Ncol is usefully in the sense that you are only mixing two colors (one primary and one secondary that is close to the traget color, which makes it more refined, as CMY are far apart), and the number gives you a good idea of how much of each color to use. Ncol is used in some paint mixing systems, such as the one used by the paint brand "Nerchau". More info:
                                                            <a href="https://en.wikipedia.org/wiki/NCol" target="_blank" style="color:#fff; text-decoration:underline;">https://en.wikipedia.org/wiki/NCol</a>
                                                        </span>
                                                    </span>
                                                </h3>
        <style>
        .tip-icon:focus .tip-tooltip,
        .tip-icon:hover .tip-tooltip {
            display: block !important;
        }
        .tip-icon svg {
            box-shadow: 0 1px 4px rgba(0,0,0,0.12);
            border-radius: 50%;
        }
        .tip-tooltip {
            transition: opacity 0.15s;
        }
        </style>
                        <div class="mixing-note" style="font-size:0.98em; margin-bottom:20px; text-align:center; color:var(--primary-color)">(Ratios are accurate to 1:8)</div>
                        <div class="ratio-item">
                            <span class="ratio-label">RYBW %:</span>
                            <span id="outputRYBW"></span>
                        </div>
                        <div class="ratio-item">
                            <span class="ratio-label">CMYW %:</span>
                            <span id="outputCMYW"></span>
                        </div>
                        <div class="ratio-item">
                            <span class="ratio-label">RYBKW%:</span>
                            <span id="outputRYBKW"></span>
                        </div>
                        <div class="ratio-item">
                            <span class="ratio-label">CMYKW%:</span>
                            <span id="outputCMYKW"></span>
                        </div>
                        <div class="ratio-item">
                            <span class="ratio-label" style="font-weight:700;">NcolWK:</span>
                            <span id="outputNcol" style="font-weight:700;"></span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer class="footer">
            <a href="#" class="footer-link">About</a>
            <a href="https://github.com/pureair/color-mix-web" target="_blank" class="footer-link">Github Repo</a>
            <span class="footer-text">Hosted on Cloudflare Pages</span>
        </footer>
    </div>

    <script src="js/script.js"></script>
    <script>
    // UI logic for ColorMixr
    function rgbToHex(r, g, b) {
        return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('').toUpperCase();
    }
    function rgbToHsv(r, g, b) {
        r /= 255; g /= 255; b /= 255;
        let max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, v = max;
        let d = max - min;
        s = max === 0 ? 0 : d / max;
        if (max === min) h = 0;
        else {
            switch (max) {
                case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                case g: h = (b - r) / d + 2; break;
                case b: h = (r - g) / d + 4; break;
            }
            h /= 6; h = h * 360;
        }
        // Return decimals, not percent
        return [h, s, v];
    }
    function showError(msg) {
        document.getElementById('errorMsg').textContent = msg;
        document.getElementById('errorMsg').style.display = 'block';
        document.getElementById('resultsSection').classList.add('hidden');
    }
    function clearError() {
        document.getElementById('errorMsg').style.display = 'none';
    }
    document.getElementById('convertButton').onclick = function() {
        clearError();
        let input = document.getElementById('colorInput').value;
        try {
            let [mode, [r, g, b]] = window.colorMix.parseInput(input);
            // Clamp values
            r = Math.max(0, Math.min(255, r));
            g = Math.max(0, Math.min(255, g));
            b = Math.max(0, Math.min(255, b));
            // Show color block
            let hex = rgbToHex(r, g, b);
            document.getElementById('inputColorBlock').style.backgroundColor = hex;
            document.getElementById('outputHex').textContent = hex;
            document.getElementById('outputRGB').textContent = `(${r}, ${g}, ${b})`;
            let [h, s, v] = rgbToHsv(r, g, b);
            document.getElementById('outputHSV').textContent = `(${h.toFixed(0)}, ${s.toFixed(2)}, ${v.toFixed(2)})`;

            // Helper for formatting: always 2-digit, no decimals, omit prefix if 100
            function fmt(prefix, val) {
                let n = Math.floor(val);
                if (n >= 100) return n;
                return prefix + n.toString().padStart(2, '0');
            }

            // CMYW %
            let [c, m, y, w] = window.colorMix.rgbToCmyw(r, g, b);
            let cmywRatio = window.colorMix.normalizeRatio([c, m, y, w]);
            let cmywText = `${fmt('C',c*100)}, ${fmt('M',m*100)}, ${fmt('Y',y*100)}, ${fmt('W',w*100)} → ratio ${cmywRatio}`;
            document.getElementById('outputCMYW').textContent = cmywText;

            // RYBW %
            let rybkw = window.colorMix.rgbToRybkw(r, g, b);
            let ryb = [rybkw.Red + rybkw.Black, rybkw.Yellow + rybkw.Black, rybkw.Blue + rybkw.Black, rybkw.White];
            let rybwRatio = window.colorMix.normalizeRatio(ryb);
            let rybwText = `${fmt('R',ryb[0])}, ${fmt('Y',ryb[1])}, ${fmt('B',ryb[2])}, ${fmt('W',ryb[3])} → ratio ${rybwRatio}`;
            document.getElementById('outputRYBW').textContent = rybwText;

            // Show notice if any RYBW value > 1
            let rybwNotice = document.getElementById('rybwNotice');
            if (!rybwNotice) {
                rybwNotice = document.createElement('div');
                rybwNotice.id = 'rybwNotice';
                rybwNotice.style.color = '#ffb347';
                rybwNotice.style.fontSize = '0.88em';
                rybwNotice.style.fontFamily = 'Cascadia Mono, monospace';
                rybwNotice.style.fontWeight = 300;
                rybwNotice.style.marginTop = '0px';
                document.getElementById('outputRYBW').parentNode.appendChild(rybwNotice);
            }
            if (ryb.slice(0, 3).some(v => v/100 > 1.01)) {
                rybwNotice.textContent = '⚠️ This color cannot be achieved by mixing RYB paints (beyond range).';
                rybwNotice.style.display = '';
            } else {
                rybwNotice.textContent = '';
                rybwNotice.style.display = 'none';
            }

            // CMYKW %
            let cmykw = window.colorMix.rgbToCmykw(r, g, b);
            let cmykwArr = [cmykw.Cyan, cmykw.Magenta, cmykw.Yellow, cmykw.Black, cmykw.White];
            let cmykwRatio = window.colorMix.getIntegerRatio(cmykw);
            let cmykwText = `${fmt('C',cmykwArr[0])}, ${fmt('M',cmykwArr[1])}, ${fmt('Y',cmykwArr[2])}, ${fmt('K',cmykwArr[3])}, ${fmt('W',cmykwArr[4])} → ratio ${cmykwRatio}`;
            document.getElementById('outputCMYKW').textContent = cmykwText;

            // RYBKW %
            let rybkwArr = [rybkw.Red, rybkw.Yellow, rybkw.Blue, rybkw.Black, rybkw.White];
            let rybkwRatio = window.colorMix.getIntegerRatio(rybkw);
            let rybkwText = `${fmt('R',rybkwArr[0])}, ${fmt('Y',rybkwArr[1])}, ${fmt('B',rybkwArr[2])}, ${fmt('K',rybkwArr[3])}, ${fmt('W',rybkwArr[4])} → ratio ${rybkwRatio}`;
            document.getElementById('outputRYBKW').textContent = rybkwText;

            document.getElementById('resultsSection').classList.remove('hidden');

            // NcolWK
            let ncol = window.colorMix.hueToNcol(h);
            ncol = ncol.substr(0, 1) + Math.round(Number(ncol.substr(1)));
            let ncolText = `${ncol}, ${Math.floor(cmykw.White)}%, ${Math.floor(cmykw.Black)}% (color wheel: R-Y-G-C-B-M-R)`;
            document.getElementById('outputNcol').textContent = ncolText;

        } catch (e) {
            showError('Invalid input. Please enter a valid color value.');
        }
    };
    // Enter key triggers convert
    document.getElementById('colorInput').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') document.getElementById('convertButton').click();
    });
    </script>
</body>
</html>
